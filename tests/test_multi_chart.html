<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MultiChartManager Tests</title>
</head>
<body>
    <div id="test-container"></div>
    <div id="test-results"></div>

    <script type="module">
        import { MultiChartManager } from '../src/frontend/multi-chart.js';

        // Test Suite
        const tests = [];
        let passed = 0;
        let failed = 0;

        function test(description, fn) {
            tests.push({ description, fn });
        }

        function assertEqual(actual, expected, message = '') {
            if (actual !== expected) {
                throw new Error(`${message}\nExpected: ${expected}\nActual: ${actual}`);
            }
        }

        function assertTrue(value, message = '') {
            if (!value) {
                throw new Error(`${message}\nExpected truthy value, got: ${value}`);
            }
        }

        function assertFalse(value, message = '') {
            if (value) {
                throw new Error(`${message}\nExpected falsy value, got: ${value}`);
            }
        }

        function assertNotNull(value, message = '') {
            if (value === null || value === undefined) {
                throw new Error(`${message}\nExpected non-null value, got: ${value}`);
            }
        }

        function assertThrows(fn, message = '') {
            try {
                fn();
                throw new Error(`${message}\nExpected function to throw an error`);
            } catch (e) {
                // Expected behavior
            }
        }

        // === Test 20.1: Constructor and Property Initialization ===
        
        test('MultiChartManager constructor accepts container and config', () => {
            const container = document.getElementById('test-container');
            const config = { mainChart: {}, subplots: [] };
            
            const manager = new MultiChartManager(container, config);
            
            assertNotNull(manager);
            assertEqual(manager.container, container);
            assertEqual(manager.config, config);
        });

        test('MultiChartManager initializes properties correctly', () => {
            const container = document.getElementById('test-container');
            const manager = new MultiChartManager(container, {});
            
            assertEqual(manager.mainChart, null);
            assertTrue(Array.isArray(manager.subplots));
            assertEqual(manager.subplots.length, 0);
            assertTrue(Array.isArray(manager.syncedCharts));
            assertEqual(manager.syncedCharts.length, 0);
        });

        test('MultiChartManager validates container element', () => {
            assertThrows(() => {
                new MultiChartManager(null, {});
            }, 'Should throw error for null container');
        });

        test('MultiChartManager validates config object', () => {
            const container = document.getElementById('test-container');
            
            assertThrows(() => {
                new MultiChartManager(container, null);
            }, 'Should throw error for null config');
        });

        test('MultiChartManager merges with default config', () => {
            const container = document.getElementById('test-container');
            const customConfig = { mainChart: { height: 500 } };
            
            const manager = new MultiChartManager(container, customConfig);
            
            assertNotNull(manager.config);
            assertEqual(manager.config.mainChart.height, 500);
        });

        test('MultiChartManager has expected methods', () => {
            const container = document.getElementById('test-container');
            const manager = new MultiChartManager(container, {});
            
            assertTrue(typeof manager.initialize === 'function');
            assertTrue(typeof manager.createContainers === 'function');
            assertTrue(typeof manager.setupSynchronization === 'function');
        });

        // Run all tests
        async function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h2>Running tests...</h2>';
            
            for (const { description, fn } of tests) {
                try {
                    await fn();
                    passed++;
                    console.log(`✓ ${description}`);
                } catch (error) {
                    failed++;
                    console.error(`✗ ${description}`);
                    console.error(error);
                }
            }
            
            resultsDiv.innerHTML = `
                <h2>Test Results</h2>
                <p>Total: ${tests.length}</p>
                <p style="color: green;">Passed: ${passed}</p>
                <p style="color: red;">Failed: ${failed}</p>
            `;
            
            if (failed === 0) {
                console.log(`✅ All ${passed} tests passed!`);
            } else {
                console.log(`❌ ${failed} test(s) failed`);
            }
        }

        runTests();
    </script>
</body>
</html>

